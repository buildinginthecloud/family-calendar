# Projen Setup for Family Calendar

## Overview

This project uses [Projen](https://github.com/projen/projen) to manage project configuration and infrastructure. Projen is a project generator that maintains complex project configurations through code rather than manual file editing.

## Current Status

⚠️ **Important**: The `.projenrc.ts` configuration file has been created but projen has not been executed yet due to the current environment running in INTEGRATIONS_ONLY network mode without Node.js/npm installed.

## Prerequisites

Before running projen, you need:
- Node.js >= 20.0.0 (specified in package.json engines)
- npm package manager

## Installation & Initialization

Once Node.js and npm are available, follow these steps:

### 1. Install Projen

```bash
npm install --save-dev projen
```

### 2. Run Projen Synthesis

This will generate/update all managed configuration files:

```bash
npx projen
```

**Important**: After running `npx projen`, the following files will be regenerated and SHOULD NOT be manually edited:
- `package.json` - Managed by projen
- `tsconfig.json` - Managed by projen
- `tsconfig.dev.json` - Generated by projen
- `cdk.json` - Managed by projen
- `jest.config.js` - Managed by projen (or may be converted to jest.config.json)
- `.eslintrc.json` - Managed by projen
- `.prettierrc.json` - Managed by projen
- `.gitignore` - Managed by projen
- `.npmignore` - Generated by projen

Any changes to these files should be made in `.projenrc.ts` and regenerated.

### 3. Install Dependencies

After projen generates the package.json, install dependencies:

```bash
npm install
```

## Configuration Highlights

The `.projenrc.ts` file configures the following per CDK and project best practices:

### TypeScript Configuration
- **Strict mode enabled**: All strict TypeScript compiler options enabled
- **Target**: ES2020
- **JSX support**: React (for frontend components)
- **Path aliases**: 
  - `@constructs/*` → `src/constructs/*`
  - `@stacks/*` → `src/stacks/*`
  - `@frontend/*` → `src/frontend/*`

### Testing Framework
- **Jest** for unit testing
- **fast-check** for property-based testing
- **Minimum 100 iterations** per property test (configured in `test/setup.ts`)
- Test coverage collection enabled
- Silent mode for test output to prevent timeouts

### Linting & Formatting
- **ESLint** configured for TypeScript
- **Prettier** for code formatting
- React plugins for frontend code
- Integration between ESLint and Prettier

### Dependencies
Key dependencies managed by projen:
- `aws-cdk-lib@^2.126.0` - AWS CDK library
- `cdk-iam-floyd@^0.2000.0` - Type-safe IAM policy generation (per CDK best practices)
- `constructs@^10.3.0` - CDK constructs base library
- `fast-check@^3.15.1` - Property-based testing
- `react@^18.2.0` & `react-dom@^18.2.0` - Frontend framework

### Custom Tasks
Projen configures several npm scripts with `cdk:` prefix per best practices:
- `cdk:synth` - Synthesize CDK stacks
- `cdk:deploy` - Deploy to AWS
- `cdk:diff` - Show differences
- `cdk:destroy` - Destroy stacks
- `cdk:bootstrap` - Bootstrap CDK toolkit
- `cdk:watch` - Watch mode for development
- `cdk:hotswap` - Fast deployment with hotswap
- `test:properties` - Run property-based tests only
- `test:unit` - Run unit tests only
- `test:watch` - Watch mode for tests
- `test:coverage` - Generate coverage report

## Project Structure

Projen enforces the following structure per CDK best practices:

```
family-calendar/
├── .projenrc.ts              # Projen configuration (edit this)
├── src/                      # All source code
│   ├── app.ts               # CDK app entry point
│   ├── constructs/          # Custom CDK constructs (Pascal-cased files)
│   │   └── {Construct}/     # Each construct in its own directory
│   │       └── handler/     # Lambda handlers for the construct
│   ├── stacks/              # CDK stacks (Pascal-cased files)
│   ├── stages/              # CDK stages (if needed)
│   └── frontend/            # React frontend components
├── test/                    # All tests
│   ├── setup.ts            # fast-check configuration (100 iterations)
│   ├── constructs/         # Construct tests (fine-grained assertions)
│   ├── stacks/             # Stack tests (snapshot tests)
│   ├── frontend/           # Frontend component tests
│   └── properties/         # Property-based tests (16 properties from design)
├── bin/                     # CDK CLI entry point
│   └── family-calendar.js
└── [generated files]        # DO NOT EDIT - managed by projen
```

## CDK Best Practices Implemented

The projen configuration implements these CDK best practices from `.kiro/steering/cdk-best-practices.md`:

1. ✅ Uses projen for project initialization and file management
2. ✅ Configures latest stable CDK version (2.126.0)
3. ✅ Uses cdk-iam-floyd for IAM policy generation
4. ✅ All source in `src/**` directory
5. ✅ Pascal-casing for construct filenames
6. ✅ Custom CDK tasks with `cdk:` prefix
7. ✅ Constructs organized in individual files
8. ✅ Lambda handlers in `handler` subdirectory of constructs
9. ✅ TypeScript strict mode enabled
10. ✅ Context avoided (empty context in cdk.json)

## Making Changes

### To modify project configuration:

1. Edit `.projenrc.ts` (never edit generated files directly)
2. Run `npx projen` to regenerate managed files
3. Commit both `.projenrc.ts` and the regenerated files

### To add dependencies:

```typescript
// In .projenrc.ts
deps: [
  'new-dependency@^1.0.0',
],
```

Then run `npx projen && npm install`.

### To add dev dependencies:

```typescript
// In .projenrc.ts
devDeps: [
  'new-dev-dependency@^1.0.0',
],
```

Then run `npx projen && npm install`.

### To add custom tasks:

```typescript
// In .projenrc.ts
project.addTask('custom-task', {
  description: 'Description of the task',
  exec: 'command to execute',
});
```

Then run `npx projen`.

## Property-Based Testing Configuration

The project is configured for property-based testing per the design document:

- **Library**: fast-check
- **Minimum iterations**: 100 per property test
- **Configuration**: Set globally in `test/setup.ts`
- **Test location**: `test/properties/`
- **Design properties**: 16 properties defined in `.kiro/specs/family-calendar-display/design.md`

Each property test should reference its design property using the format:
```typescript
/**
 * Feature: family-calendar-display, Property {number}: {property_text}
 */
```

## Next Steps

Once Node.js and npm are available:

1. Run `npm install --save-dev projen` to install projen
2. Run `npx projen` to generate all configuration files
3. Run `npm install` to install all dependencies
4. Run `npm test` to verify the setup
5. Run `npm run build` to compile TypeScript
6. Run `npm run cdk:synth` to synthesize CDK stacks

## Troubleshooting

### "Cannot find module 'projen'"
Run: `npm install --save-dev projen`

### "Files were modified by projen"
This is expected. Commit the changes after reviewing them.

### "Type errors after running projen"
Run: `npm install` to ensure all dependencies are installed.

### "CDK version mismatch"
Update the `cdkVersion` in `.projenrc.ts` and run `npx projen && npm install`.

## References

- [Projen Documentation](https://projen.io/)
- [AWS CDK Best Practices](.kiro/steering/cdk-best-practices.md)
- [TypeScript Best Practices](.kiro/steering/typescript-best-practices.md)
- [Testing Best Practices](.kiro/steering/testing-best-practices.md)
- [Design Document](.kiro/specs/family-calendar-display/design.md)
